<!DOCTYPE html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Car Mechanic AR</title>
    
	<!--include styles-->
    <link rel="stylesheet" href="https://use.typekit.net/nky6crf.css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/site.css">
	<!-- include three.js library -->
	<script src='js/three.js'></script>
	<!-- include jsartookit -->
    <script src="js/jsartoolkit5/build/artoolkit.min.js"></script>
    <script src="js/jsartoolkit5/js/artoolkit.api.js"></script>
	<!-- include threex.artoolkit -->
	<script src="js/arJs/three.js/src/threex/threex-artoolkitsource.js"></script>
    <script src="js/arJs/three.js/src/threex/threex-artoolkitcontext.js"></script>
    <script src="js/arJs/three.js/src/threex/threex-arbasecontrols.js"></script>
    <script src="js/arJs/three.js/src/threex/threex-armarkercontrols.js"></script>
	<!--GLTF LOADER-->
	<script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/GLTFLoader.js"></script>
</head>

<body style='margin : 0px; overflow: hidden; font-family: Monospace;'>

<script>
// init renderer
    var renderer	= new THREE.WebGLRenderer({
		antialias	: true,
		alpha: true
	});
	renderer.setClearColor(new THREE.Color('lightgrey'), 0)
	renderer.setSize( window.innerWidth, window.innerHeight );
	renderer.domElement.style.position = 'absolute'
	renderer.domElement.style.top = '0px'
	renderer.domElement.style.left = '0px'
	document.body.appendChild( renderer.domElement );

	// array of functions for the rendering loop
	var onRenderFcts= [];

	// init scene and camera
	var scene	= new THREE.Scene();

	//////////////////////////////////////////////////////////////////////////////////
	//		Initialize a basic camera
	//////////////////////////////////////////////////////////////////////////////////

	// Create a camera
	var camera = new THREE.Camera();
	scene.add(camera);
	
	////////////////////////////////////////////////////////////
	// setup arToolkitSource
	////////////////////////////////////////////////////////////
	arToolkitSource = new THREEx.ArToolkitSource({
		sourceType : 'webcam',
    });
    
    arToolkitSource.init(function onReady(){
		onResize()
	});

	// handle resize
	window.addEventListener('resize', function(){
		onResize()
	})
	function onResize(){
		arToolkitSource.onResizeElement()
		arToolkitSource.copyElementSizeTo(renderer.domElement)
		if( arToolkitContext.arController !== null ){
			arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas)
		}
	}
	
	////////////////////////////////////////////////////////////
	// setup arToolkitContext
	////////////////////////////////////////////////////////////	
	// create atToolkitContext
	arToolkitContext = new THREEx.ArToolkitContext({
		cameraParametersUrl: 'js/arJS/data/data/camera_para.dat',
		detectionMode: 'mono'
	});
	
	// copy projection matrix to camera when initialization complete
	arToolkitContext.init( function onCompleted(){
		camera.projectionMatrix.copy( arToolkitContext.getProjectionMatrix() );
    });
    
    // update artoolkit on every frame
	onRenderFcts.push(function(){
		if( arToolkitSource.ready === false )	return

		arToolkitContext.update( arToolkitSource.domElement )
    })
    
	;(function(){

//////////////////////////////////////////////////////////////////////////////
//		markerRoot1
//////////////////////////////////////////////////////////////////////////////

// build markerControls
var markerRoot1 = new THREE.Group
markerRoot1.name = 'marker1'
scene.add(markerRoot1)
var markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot1, {
    type : 'pattern',
    patternUrl : 'js/arJs/data/data/patt.hiro',
    // patternUrl : THREEx.ArToolkitContext.baseURL + '../data/data/patt.kanji',
})

var loader = new THREE.TextureLoader();

// Load an image file into a custom material
var material1 = new THREE.MeshLambertMaterial({
  map: loader.load('img/tooltipOilSmall.png')
});
var geometry1 = new THREE.PlaneGeometry(5, 5, 1, 1);
var mesh1 = new THREE.Mesh(geometry1, material1);
mesh1.scale.set(0.4, 0.4, 0.4);
mesh1.position.set(0,0,0);
markerRoot1.add(mesh1);
// so image isnt black
var light = new THREE.PointLight( 0xffffff, 1, 0 );
light.position.set(1, 1, 100 );
markerRoot1.add(light);

//////////////////////////////////////////////////////////////////////////////
//		markerRoot2
//////////////////////////////////////////////////////////////////////////////

// build markerControls
var markerRoot2 = new THREE.Group
markerRoot2.name = 'marker2'
scene.add(markerRoot2)
var markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot2, {
    type : 'pattern',
    // patternUrl : THREEx.ArToolkitContext.baseURL + '../data/data/patt.hiro',
    patternUrl : 'js/arJs/data/data/patt.kanji',
})

// add a gizmo in the center of the marker
var geometry	= new THREE.OctahedronGeometry( 0.1, 0 )
var material	= new THREE.MeshNormalMaterial({
    wireframe: true
});
var mesh	= new THREE.Mesh( geometry, material );
markerRoot2.add( mesh );
})() // end of strange function

onRenderFcts.push(function(){
		renderer.render( scene, camera );
	})

	// run the rendering loop
	var lastTimeMsec= null
	requestAnimationFrame(function animate(nowMsec){
		// keep looping
		requestAnimationFrame( animate );
		// measure time
		lastTimeMsec	= lastTimeMsec || nowMsec-1000/60
		var deltaMsec	= Math.min(200, nowMsec - lastTimeMsec)
		lastTimeMsec	= nowMsec
		// call each update function
		onRenderFcts.forEach(function(onRenderFct){
			onRenderFct(deltaMsec/1000, nowMsec/1000)
		})
	})
</script>

<header class="header">
    <p class="instructions instructionsSmall">Open the hood of your car and point the camera towards the engine</p>
  </header>


    <a href="taskSelection.html">
      <div class="scanIndicator"></div>
    </a>
    <a href="menu.html">
      <div class="buttonPrevious"><i data-feather="chevron-left"></i></div>
    </a>


<script src="https://cdnjs.cloudflare.com/ajax/libs/feather-icons/4.9.0/feather.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.0.4/gsap.min.js"></script>
<script src="js/main.js"></script> 

</body>
</html>